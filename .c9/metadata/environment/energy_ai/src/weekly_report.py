{"filter":false,"title":"weekly_report.py","tooltip":"/energy_ai/src/weekly_report.py","undoManager":{"mark":72,"position":72,"stack":[[{"start":{"row":0,"column":0},"end":{"row":119,"column":0},"action":"insert","lines":["import boto3","import json","import csv","import io","import json","import os","  ","# Environment variables setting","region = os.environ['REGION_NAME']","bedrock_model_id = os.environ['BEDROCK_MODEL']","","","# Initialize S3 & SNS & DynamoDB client","s3 = boto3.client('s3', region)","sns_client = boto3.client('sns')","","def gen_weekly_report(event, context):","    print(event)","    print(\"Received event:\", json.dumps(event, indent=2))","    # 設定存儲桶名稱和檔案名稱","    # Extract information from the event","    bucket_name = os.environ['S3_BUCKET_NAME']","    object_key = os.environ['S3_OBJECT_KEY']","    ","    # for record in event['Records']:","    #     bucket_name = record['s3']['bucket']['name']","    #     object_key = record['s3']['object']['key']","    #     event_name = record['eventName']","        ","        # bucket_name = 'rong-test-0512'","        # file_key = 'energy.csv'","    ","    # 讀取 CSV 檔案","    response = s3.get_object(Bucket=bucket_name, Key=object_key)","    csv_content = response['Body'].read().decode('utf-8')","    ","    # 將 CSV 轉換為 JSON 格式","    csv_rows = csv.DictReader(io.StringIO(csv_content))","    json_output = json.dumps([row for row in csv_rows])","    print(json_output)","","# json_content2 = [","#    {\"date\": \"2024/3/4\", \"career\": \"102\", \"store\": \"10202\", \"net\": \"45237\"}, {\"date\": \"2024/3/5\", \"career\": \"102\", \"store\": \"10202\", \"net\": \"34786\"}","# ]","","# # 將 JSON 轉換為字串","# json_output2 = json.dumps(json_content2)","","","","    # 根據 CSV 檔案的內容動態生成提示訊息","","    # prompt = f'explain the text {json_output}'","    # prompt = f'explain the text {json_output2}'","    prompt = f\"\"\"","    You are an energy analyst assistant. Your task is to analyze weekly energy consumption data from a CSV file and generate a succinct weekly energy usage report. The report should include:","        ","    1. A summary of the total energy consumption for the week, compared to the previous week and the 4-week average.","    2. Identification of any abnormal usage patterns, such as significant spikes or drops in consumption on particular days.","    3. Potential reasons for abnormal patterns, such as weather events, operational changes, faulty equipment, etc. Provide relevant recommendations to address any issues.","    4. Energy usage highlights, such as days with highest/lowest consumption, top consuming facilities, etc.","    5. Forecasts for energy needs in the upcoming week based on historical data and known factors.","        ","    Here is the weekly energy consumption data in JSON format:","        ","    {json_output}","    ","    Please generate the weekly energy usage report based on the data provided, following the guidelines outlined above. Keep the report concise, focused and insightful.","    \"\"\"","","        ","    # 建立 Bedrock 客戶端","    bedrock = boto3.client(","        service_name='bedrock-runtime'#,","        # region_name='us-west-2'","    )  ","","    ","    # 設置 Bedrock 模型的輸入參數","    input_data = {","        \"modelId\": bedrock_model_id,  # \"cohere.command-text-v14\",","        \"contentType\": \"application/json\",","        \"accept\": \"*/*\",","        \"body\": {","            \"prompt\": prompt,","            \"max_tokens\": 1000,","            \"temperature\": 0.75,","            \"p\": 0.01,","            \"k\": 0,","            \"stop_sequences\": [],","            \"return_likelihoods\": \"NONE\"","        }","    }","    ","    # 呼叫 Bedrock 模型","    response = bedrock.invoke_model(","        body=json.dumps(input_data[\"body\"]),","        modelId=input_data[\"modelId\"],","        accept=input_data[\"accept\"],","        contentType=input_data[\"contentType\"]","    )","","    # 讀取上面的s3內檔案並解析回應","    response_body = json.loads(response['body'].read())","    explanation = response_body['generations'][0]['text']","    # print(explanation)","","    sns_topic_arn = os.environ['SNS_ARN']","    message_text = f\"Dear Facility Manager, \\n {explanation} \\n Regards,\\n Your AI Assistant\"","    subject_text = \"Facility update: Weekly report for energy data\"","    try:","        sent_message = sns_client.publish(TopicArn=sns_topic_arn, Message=message_text, Subject=subject_text)","        if sent_message['ResponseMetadata']['HTTPStatusCode'] == 200:","            print(sent_message)","            print(\"Report send successfully..!!!\")","            return True","    except Exception as e:","        print(\"Error occured while publish reports and error is : \", e)","        return True",""],"id":1}],[{"start":{"row":54,"column":17},"end":{"row":55,"column":0},"action":"insert","lines":["",""],"id":2},{"start":{"row":55,"column":0},"end":{"row":55,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":55,"column":4},"end":{"row":72,"column":93},"action":"insert","lines":[" As an energy management expert with over 30 years of experience, we're reaching out to you for assistance in analyzing weekly data related to building energy consumption. Your insights are invaluable in resolving this issue.","### Weekly Energy Usage Summary","- Total energy consumption for this week: {this_week_total:.2f} kWh","- Change from last week: {week_over_week_change_percent:.2f}% ({'Increase' if week_over_week_change_percent > 0 else 'Decrease'})","","#### Key Observations:","1. Total consumption this week: {this_week_total:.2f} kWh","2. Total consumption last week: {last_week_total:.2f} kWh","3. Percentage change: {week_over_week_change_percent:.2f}%","","Please review the above summary for quick insights into the energy consumption for the week.The report should include:","","1. A summary of the total energy consumption for the week, compared to the previous week and the 4-week average.","2. Identification of any abnormal usage patterns, such as significant spikes or drops in consumption on particular days.","3. Potential reasons for abnormal patterns, such as weather events, operational changes, faulty equipment, etc. Provide relevant recommendations to address any issues.","4. Energy usage highlights, such as days with highest/lowest consumption, top consuming facilities, etc.","5. Forecasts for energy needs in the upcoming week based on historical data and known factors.","6. Your suggestions should be detailed and specific to effectively address the weekly report."],"id":3}],[{"start":{"row":72,"column":93},"end":{"row":73,"column":0},"action":"insert","lines":["",""],"id":4}],[{"start":{"row":55,"column":4},"end":{"row":55,"column":5},"action":"remove","lines":[" "],"id":5}],[{"start":{"row":56,"column":0},"end":{"row":57,"column":0},"action":"insert","lines":["",""],"id":6}],[{"start":{"row":56,"column":0},"end":{"row":56,"column":4},"action":"insert","lines":["    "],"id":7}],[{"start":{"row":56,"column":4},"end":{"row":56,"column":5},"action":"insert","lines":["P"],"id":8}],[{"start":{"row":56,"column":5},"end":{"row":56,"column":6},"action":"insert","lines":["l"],"id":9},{"start":{"row":56,"column":6},"end":{"row":56,"column":7},"action":"insert","lines":["e"]},{"start":{"row":56,"column":7},"end":{"row":56,"column":8},"action":"insert","lines":["s"]}],[{"start":{"row":56,"column":7},"end":{"row":56,"column":8},"action":"remove","lines":["s"],"id":10}],[{"start":{"row":56,"column":7},"end":{"row":56,"column":8},"action":"insert","lines":["a"],"id":11},{"start":{"row":56,"column":8},"end":{"row":56,"column":9},"action":"insert","lines":["s"]},{"start":{"row":56,"column":9},"end":{"row":56,"column":10},"action":"insert","lines":["e"]}],[{"start":{"row":56,"column":10},"end":{"row":56,"column":11},"action":"insert","lines":[" "],"id":12},{"start":{"row":56,"column":11},"end":{"row":56,"column":12},"action":"insert","lines":["p"]},{"start":{"row":56,"column":12},"end":{"row":56,"column":13},"action":"insert","lines":["r"]},{"start":{"row":56,"column":13},"end":{"row":56,"column":14},"action":"insert","lines":["o"]},{"start":{"row":56,"column":14},"end":{"row":56,"column":15},"action":"insert","lines":["c"]}],[{"start":{"row":56,"column":14},"end":{"row":56,"column":15},"action":"remove","lines":["c"],"id":13}],[{"start":{"row":56,"column":14},"end":{"row":56,"column":15},"action":"insert","lines":["v"],"id":14},{"start":{"row":56,"column":15},"end":{"row":56,"column":16},"action":"insert","lines":["i"]},{"start":{"row":56,"column":16},"end":{"row":56,"column":17},"action":"insert","lines":["d"]},{"start":{"row":56,"column":17},"end":{"row":56,"column":18},"action":"insert","lines":["e"]}],[{"start":{"row":56,"column":18},"end":{"row":56,"column":19},"action":"insert","lines":[" "],"id":15},{"start":{"row":56,"column":19},"end":{"row":56,"column":20},"action":"insert","lines":["y"]},{"start":{"row":56,"column":20},"end":{"row":56,"column":21},"action":"insert","lines":["o"]},{"start":{"row":56,"column":21},"end":{"row":56,"column":22},"action":"insert","lines":["u"]},{"start":{"row":56,"column":22},"end":{"row":56,"column":23},"action":"insert","lines":["r"]}],[{"start":{"row":56,"column":23},"end":{"row":56,"column":24},"action":"insert","lines":[" "],"id":16},{"start":{"row":56,"column":24},"end":{"row":56,"column":25},"action":"insert","lines":["a"]},{"start":{"row":56,"column":25},"end":{"row":56,"column":26},"action":"insert","lines":["d"]},{"start":{"row":56,"column":26},"end":{"row":56,"column":27},"action":"insert","lines":["v"]},{"start":{"row":56,"column":27},"end":{"row":56,"column":28},"action":"insert","lines":["i"]},{"start":{"row":56,"column":28},"end":{"row":56,"column":29},"action":"insert","lines":["c"]},{"start":{"row":56,"column":29},"end":{"row":56,"column":30},"action":"insert","lines":["e"]}],[{"start":{"row":56,"column":30},"end":{"row":56,"column":31},"action":"insert","lines":[" "],"id":17},{"start":{"row":56,"column":31},"end":{"row":56,"column":32},"action":"insert","lines":["i"]},{"start":{"row":56,"column":32},"end":{"row":56,"column":33},"action":"insert","lines":["n"]}],[{"start":{"row":56,"column":32},"end":{"row":56,"column":33},"action":"remove","lines":["n"],"id":18},{"start":{"row":56,"column":31},"end":{"row":56,"column":32},"action":"remove","lines":["i"]}],[{"start":{"row":56,"column":31},"end":{"row":56,"column":32},"action":"insert","lines":["w"],"id":19},{"start":{"row":56,"column":32},"end":{"row":56,"column":33},"action":"insert","lines":["h"]}],[{"start":{"row":56,"column":32},"end":{"row":56,"column":33},"action":"remove","lines":["h"],"id":20}],[{"start":{"row":56,"column":32},"end":{"row":56,"column":33},"action":"insert","lines":["i"],"id":21},{"start":{"row":56,"column":33},"end":{"row":56,"column":34},"action":"insert","lines":["t"]},{"start":{"row":56,"column":34},"end":{"row":56,"column":35},"action":"insert","lines":["h"]}],[{"start":{"row":56,"column":35},"end":{"row":56,"column":36},"action":"insert","lines":[" "],"id":22},{"start":{"row":56,"column":36},"end":{"row":56,"column":37},"action":"insert","lines":["t"]},{"start":{"row":56,"column":37},"end":{"row":56,"column":38},"action":"insert","lines":["h"]},{"start":{"row":56,"column":38},"end":{"row":56,"column":39},"action":"insert","lines":["e"]}],[{"start":{"row":56,"column":39},"end":{"row":56,"column":40},"action":"insert","lines":[" "],"id":23},{"start":{"row":56,"column":40},"end":{"row":56,"column":41},"action":"insert","lines":["f"]},{"start":{"row":56,"column":41},"end":{"row":56,"column":42},"action":"insert","lines":["o"]},{"start":{"row":56,"column":42},"end":{"row":56,"column":43},"action":"insert","lines":["l"]},{"start":{"row":56,"column":43},"end":{"row":56,"column":44},"action":"insert","lines":["l"]},{"start":{"row":56,"column":44},"end":{"row":56,"column":45},"action":"insert","lines":["o"]}],[{"start":{"row":56,"column":45},"end":{"row":56,"column":46},"action":"insert","lines":["w"],"id":24},{"start":{"row":56,"column":46},"end":{"row":56,"column":47},"action":"insert","lines":["i"]},{"start":{"row":56,"column":47},"end":{"row":56,"column":48},"action":"insert","lines":["n"]},{"start":{"row":56,"column":48},"end":{"row":56,"column":49},"action":"insert","lines":["g"]}],[{"start":{"row":56,"column":49},"end":{"row":56,"column":50},"action":"insert","lines":[" "],"id":25},{"start":{"row":56,"column":50},"end":{"row":56,"column":51},"action":"insert","lines":["d"]}],[{"start":{"row":56,"column":50},"end":{"row":56,"column":51},"action":"remove","lines":["d"],"id":26}],[{"start":{"row":56,"column":50},"end":{"row":56,"column":51},"action":"insert","lines":["s"],"id":27},{"start":{"row":56,"column":51},"end":{"row":56,"column":52},"action":"insert","lines":["t"]},{"start":{"row":56,"column":52},"end":{"row":56,"column":53},"action":"insert","lines":["r"]},{"start":{"row":56,"column":53},"end":{"row":56,"column":54},"action":"insert","lines":["u"]},{"start":{"row":56,"column":54},"end":{"row":56,"column":55},"action":"insert","lines":["c"]},{"start":{"row":56,"column":55},"end":{"row":56,"column":56},"action":"insert","lines":["t"]},{"start":{"row":56,"column":56},"end":{"row":56,"column":57},"action":"insert","lines":["u"]}],[{"start":{"row":56,"column":57},"end":{"row":56,"column":58},"action":"insert","lines":["r"],"id":28},{"start":{"row":56,"column":58},"end":{"row":56,"column":59},"action":"insert","lines":["e"]},{"start":{"row":56,"column":59},"end":{"row":56,"column":60},"action":"insert","lines":[":"]}],[{"start":{"row":57,"column":0},"end":{"row":57,"column":4},"action":"insert","lines":["    "],"id":29},{"start":{"row":58,"column":0},"end":{"row":58,"column":4},"action":"insert","lines":["    "]},{"start":{"row":59,"column":0},"end":{"row":59,"column":4},"action":"insert","lines":["    "]},{"start":{"row":60,"column":0},"end":{"row":60,"column":4},"action":"insert","lines":["    "]},{"start":{"row":61,"column":0},"end":{"row":61,"column":4},"action":"insert","lines":["    "]},{"start":{"row":62,"column":0},"end":{"row":62,"column":4},"action":"insert","lines":["    "]},{"start":{"row":63,"column":0},"end":{"row":63,"column":4},"action":"insert","lines":["    "]},{"start":{"row":64,"column":0},"end":{"row":64,"column":4},"action":"insert","lines":["    "]},{"start":{"row":65,"column":0},"end":{"row":65,"column":4},"action":"insert","lines":["    "]},{"start":{"row":66,"column":0},"end":{"row":66,"column":4},"action":"insert","lines":["    "]},{"start":{"row":67,"column":0},"end":{"row":67,"column":4},"action":"insert","lines":["    "]},{"start":{"row":68,"column":0},"end":{"row":68,"column":4},"action":"insert","lines":["    "]},{"start":{"row":69,"column":0},"end":{"row":69,"column":4},"action":"insert","lines":["    "]},{"start":{"row":70,"column":0},"end":{"row":70,"column":4},"action":"insert","lines":["    "]},{"start":{"row":71,"column":0},"end":{"row":71,"column":4},"action":"insert","lines":["    "]},{"start":{"row":72,"column":0},"end":{"row":72,"column":4},"action":"insert","lines":["    "]},{"start":{"row":73,"column":0},"end":{"row":73,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":75,"column":0},"end":{"row":88,"column":0},"action":"remove","lines":["    You are an energy analyst assistant. Your task is to analyze weekly energy consumption data from a CSV file and generate a succinct weekly energy usage report. The report should include:","        ","    1. A summary of the total energy consumption for the week, compared to the previous week and the 4-week average.","    2. Identification of any abnormal usage patterns, such as significant spikes or drops in consumption on particular days.","    3. Potential reasons for abnormal patterns, such as weather events, operational changes, faulty equipment, etc. Provide relevant recommendations to address any issues.","    4. Energy usage highlights, such as days with highest/lowest consumption, top consuming facilities, etc.","    5. Forecasts for energy needs in the upcoming week based on historical data and known factors.","        ","    Here is the weekly energy consumption data in JSON format:","        ","    {json_output}","    ","    Please generate the weekly energy usage report based on the data provided, following the guidelines outlined above. Keep the report concise, focused and insightful.",""]}],[{"start":{"row":60,"column":0},"end":{"row":60,"column":4},"action":"remove","lines":["    "],"id":31}],[{"start":{"row":56,"column":60},"end":{"row":57,"column":0},"action":"insert","lines":["",""],"id":32},{"start":{"row":57,"column":0},"end":{"row":57,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":57,"column":4},"end":{"row":67,"column":168},"action":"insert","lines":["    1. A summary of the total energy consumption for the week, compared to the previous week and the 4-week average.","    2. Identification of any abnormal usage patterns, such as significant spikes or drops in consumption on particular days.","    3. Potential reasons for abnormal patterns, such as weather events, operational changes, faulty equipment, etc. Provide relevant recommendations to address any issues.","    4. Energy usage highlights, such as days with highest/lowest consumption, top consuming facilities, etc.","    5. Forecasts for energy needs in the upcoming week based on historical data and known factors.","        ","    Here is the weekly energy consumption data in JSON format:","        ","    {json_output}","    ","    Please generate the weekly energy usage report based on the data provided, following the guidelines outlined above. Keep the report concise, focused and insightful."],"id":33}],[{"start":{"row":67,"column":168},"end":{"row":68,"column":0},"action":"insert","lines":["",""],"id":34},{"start":{"row":68,"column":0},"end":{"row":68,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":57,"column":0},"end":{"row":57,"column":4},"action":"remove","lines":["    "],"id":35}],[{"start":{"row":68,"column":4},"end":{"row":69,"column":0},"action":"insert","lines":["",""],"id":36},{"start":{"row":69,"column":0},"end":{"row":69,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":69,"column":4},"end":{"row":76,"column":97},"action":"insert","lines":["    Please review the above summary for quick insights into the energy consumption for the week.The report should include:","    ","    1. A summary of the total energy consumption for the week, compared to the previous week and the 4-week average.","    2. Identification of any abnormal usage patterns, such as significant spikes or drops in consumption on particular days.","    3. Potential reasons for abnormal patterns, such as weather events, operational changes, faulty equipment, etc. Provide relevant recommendations to address any issues.","    4. Energy usage highlights, such as days with highest/lowest consumption, top consuming facilities, etc.","    5. Forecasts for energy needs in the upcoming week based on historical data and known factors.","    6. Your suggestions should be detailed and specific to effectively address the weekly report."],"id":37}],[{"start":{"row":76,"column":97},"end":{"row":77,"column":0},"action":"insert","lines":["",""],"id":38},{"start":{"row":77,"column":0},"end":{"row":77,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":69,"column":0},"end":{"row":69,"column":4},"action":"remove","lines":["    "],"id":39}],[{"start":{"row":78,"column":4},"end":{"row":95,"column":0},"action":"remove","lines":["### Weekly Energy Usage Summary","    - Total energy consumption for this week: {this_week_total:.2f} kWh","    - Change from last week: {week_over_week_change_percent:.2f}% ({'Increase' if week_over_week_change_percent > 0 else 'Decrease'})","","    #### Key Observations:","    1. Total consumption this week: {this_week_total:.2f} kWh","    2. Total consumption last week: {last_week_total:.2f} kWh","    3. Percentage change: {week_over_week_change_percent:.2f}%","    ","    Please review the above summary for quick insights into the energy consumption for the week.The report should include:","    ","    1. A summary of the total energy consumption for the week, compared to the previous week and the 4-week average.","    2. Identification of any abnormal usage patterns, such as significant spikes or drops in consumption on particular days.","    3. Potential reasons for abnormal patterns, such as weather events, operational changes, faulty equipment, etc. Provide relevant recommendations to address any issues.","    4. Energy usage highlights, such as days with highest/lowest consumption, top consuming facilities, etc.","    5. Forecasts for energy needs in the upcoming week based on historical data and known factors.","    6. Your suggestions should be detailed and specific to effectively address the weekly report.",""],"id":40},{"start":{"row":78,"column":0},"end":{"row":78,"column":4},"action":"remove","lines":["    "]},{"start":{"row":77,"column":4},"end":{"row":78,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":77,"column":0},"end":{"row":77,"column":4},"action":"remove","lines":["    "],"id":41},{"start":{"row":76,"column":97},"end":{"row":77,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":71,"column":0},"end":{"row":76,"column":97},"action":"remove","lines":["    1. A summary of the total energy consumption for the week, compared to the previous week and the 4-week average.","    2. Identification of any abnormal usage patterns, such as significant spikes or drops in consumption on particular days.","    3. Potential reasons for abnormal patterns, such as weather events, operational changes, faulty equipment, etc. Provide relevant recommendations to address any issues.","    4. Energy usage highlights, such as days with highest/lowest consumption, top consuming facilities, etc.","    5. Forecasts for energy needs in the upcoming week based on historical data and known factors.","    6. Your suggestions should be detailed and specific to effectively address the weekly report."],"id":42}],[{"start":{"row":57,"column":0},"end":{"row":61,"column":98},"action":"remove","lines":["    1. A summary of the total energy consumption for the week, compared to the previous week and the 4-week average.","    2. Identification of any abnormal usage patterns, such as significant spikes or drops in consumption on particular days.","    3. Potential reasons for abnormal patterns, such as weather events, operational changes, faulty equipment, etc. Provide relevant recommendations to address any issues.","    4. Energy usage highlights, such as days with highest/lowest consumption, top consuming facilities, etc.","    5. Forecasts for energy needs in the upcoming week based on historical data and known factors."],"id":43},{"start":{"row":57,"column":0},"end":{"row":62,"column":97},"action":"insert","lines":["    1. A summary of the total energy consumption for the week, compared to the previous week and the 4-week average.","    2. Identification of any abnormal usage patterns, such as significant spikes or drops in consumption on particular days.","    3. Potential reasons for abnormal patterns, such as weather events, operational changes, faulty equipment, etc. Provide relevant recommendations to address any issues.","    4. Energy usage highlights, such as days with highest/lowest consumption, top consuming facilities, etc.","    5. Forecasts for energy needs in the upcoming week based on historical data and known factors.","    6. Your suggestions should be detailed and specific to effectively address the weekly report."]}],[{"start":{"row":64,"column":3},"end":{"row":67,"column":4},"action":"remove","lines":[" Here is the weekly energy consumption data in JSON format:","        ","    {json_output}","    "],"id":44}],[{"start":{"row":56,"column":4},"end":{"row":57,"column":0},"action":"insert","lines":["",""],"id":45},{"start":{"row":57,"column":0},"end":{"row":57,"column":4},"action":"insert","lines":["    "]},{"start":{"row":57,"column":4},"end":{"row":58,"column":0},"action":"insert","lines":["",""]},{"start":{"row":58,"column":0},"end":{"row":58,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":57,"column":4},"end":{"row":60,"column":4},"action":"insert","lines":[" Here is the weekly energy consumption data in JSON format:","        ","    {json_output}","    "],"id":46}],[{"start":{"row":57,"column":0},"end":{"row":57,"column":4},"action":"remove","lines":["    "],"id":47}],[{"start":{"row":57,"column":0},"end":{"row":57,"column":1},"action":"remove","lines":[" "],"id":48}],[{"start":{"row":57,"column":0},"end":{"row":57,"column":4},"action":"insert","lines":["    "],"id":49}],[{"start":{"row":71,"column":0},"end":{"row":73,"column":4},"action":"remove","lines":["    ","    Please review the above summary for quick insights into the energy consumption for the week.The report should include:","    "],"id":50},{"start":{"row":70,"column":168},"end":{"row":71,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":70,"column":168},"end":{"row":71,"column":0},"action":"remove","lines":["",""],"id":51}],[{"start":{"row":24,"column":0},"end":{"row":30,"column":33},"action":"remove","lines":["    # for record in event['Records']:","    #     bucket_name = record['s3']['bucket']['name']","    #     object_key = record['s3']['object']['key']","    #     event_name = record['eventName']","        ","        # bucket_name = 'rong-test-0512'","        # file_key = 'energy.csv'"],"id":52}],[{"start":{"row":24,"column":0},"end":{"row":26,"column":15},"action":"remove","lines":["","    ","    # 讀取 CSV 檔案"],"id":53},{"start":{"row":23,"column":4},"end":{"row":24,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":32,"column":0},"end":{"row":39,"column":0},"action":"remove","lines":["# json_content2 = [","#    {\"date\": \"2024/3/4\", \"career\": \"102\", \"store\": \"10202\", \"net\": \"45237\"}, {\"date\": \"2024/3/5\", \"career\": \"102\", \"store\": \"10202\", \"net\": \"34786\"}","# ]","","# # 將 JSON 轉換為字串","# json_output2 = json.dumps(json_content2)","",""],"id":54},{"start":{"row":31,"column":0},"end":{"row":32,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":30,"column":4},"end":{"row":30,"column":6},"action":"insert","lines":["# "],"id":55}],[{"start":{"row":31,"column":0},"end":{"row":36,"column":49},"action":"remove","lines":["","","    # 根據 CSV 檔案的內容動態生成提示訊息","","    # prompt = f'explain the text {json_output}'","    # prompt = f'explain the text {json_output2}'"],"id":56}],[{"start":{"row":19,"column":0},"end":{"row":19,"column":18},"action":"remove","lines":["    # 設定存儲桶名稱和檔案名稱"],"id":57}],[{"start":{"row":17,"column":4},"end":{"row":17,"column":6},"action":"insert","lines":["# "],"id":58}],[{"start":{"row":17,"column":0},"end":{"row":19,"column":0},"action":"remove","lines":["    # print(event)","    print(\"Received event:\", json.dumps(event, indent=2))",""],"id":59},{"start":{"row":16,"column":38},"end":{"row":17,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":16,"column":38},"end":{"row":17,"column":0},"action":"insert","lines":["",""],"id":60},{"start":{"row":17,"column":0},"end":{"row":17,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":25,"column":6},"end":{"row":25,"column":7},"action":"insert","lines":["c"],"id":61},{"start":{"row":25,"column":7},"end":{"row":25,"column":8},"action":"insert","lines":["s"]},{"start":{"row":25,"column":8},"end":{"row":25,"column":9},"action":"insert","lines":["v"]}],[{"start":{"row":25,"column":9},"end":{"row":25,"column":10},"action":"insert","lines":[" "],"id":62},{"start":{"row":25,"column":10},"end":{"row":25,"column":11},"action":"insert","lines":["t"]},{"start":{"row":25,"column":11},"end":{"row":25,"column":12},"action":"insert","lines":["o"]}],[{"start":{"row":25,"column":12},"end":{"row":25,"column":13},"action":"insert","lines":[" "],"id":63},{"start":{"row":25,"column":13},"end":{"row":25,"column":14},"action":"insert","lines":["j"]},{"start":{"row":25,"column":14},"end":{"row":25,"column":15},"action":"insert","lines":["s"]},{"start":{"row":25,"column":15},"end":{"row":25,"column":16},"action":"insert","lines":["o"]},{"start":{"row":25,"column":16},"end":{"row":25,"column":17},"action":"insert","lines":["n"]}],[{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["將"],"id":64},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":[" "]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["C"]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["S"]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["V"]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":[" "]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["轉"]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["換"]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["為"]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":[" "]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["J"]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["S"]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["O"]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["N"]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":[" "]},{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["格"]}],[{"start":{"row":25,"column":17},"end":{"row":25,"column":18},"action":"remove","lines":["式"],"id":65}],[{"start":{"row":44,"column":4},"end":{"row":44,"column":8},"action":"remove","lines":["    "],"id":66},{"start":{"row":44,"column":0},"end":{"row":44,"column":4},"action":"remove","lines":["    "]},{"start":{"row":43,"column":97},"end":{"row":44,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":48,"column":0},"end":{"row":49,"column":20},"action":"remove","lines":["        ","    # 建立 Bedrock 客戶端"],"id":67}],[{"start":{"row":51,"column":0},"end":{"row":51,"column":33},"action":"remove","lines":["        # region_name='us-west-2'"],"id":68},{"start":{"row":50,"column":40},"end":{"row":51,"column":0},"action":"remove","lines":["",""]},{"start":{"row":50,"column":39},"end":{"row":50,"column":40},"action":"remove","lines":[","]},{"start":{"row":50,"column":38},"end":{"row":50,"column":39},"action":"remove","lines":["#"]}],[{"start":{"row":47,"column":0},"end":{"row":48,"column":0},"action":"remove","lines":["",""],"id":69}],[{"start":{"row":51,"column":0},"end":{"row":53,"column":24},"action":"remove","lines":["","    ","    # 設置 Bedrock 模型的輸入參數"],"id":70},{"start":{"row":50,"column":7},"end":{"row":51,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":66,"column":0},"end":{"row":66,"column":19},"action":"remove","lines":["    # 呼叫 Bedrock 模型"],"id":71},{"start":{"row":65,"column":4},"end":{"row":66,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":73,"column":0},"end":{"row":73,"column":21},"action":"remove","lines":["    # 讀取上面的s3內檔案並解析回應"],"id":72},{"start":{"row":72,"column":0},"end":{"row":73,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":75,"column":0},"end":{"row":75,"column":24},"action":"remove","lines":["    # print(explanation)"],"id":73},{"start":{"row":74,"column":57},"end":{"row":75,"column":0},"action":"remove","lines":["",""]}]]},"ace":{"folds":[],"scrolltop":973.9999701976787,"scrollleft":0,"selection":{"start":{"row":74,"column":57},"end":{"row":74,"column":57},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":209,"mode":"ace/mode/python"}},"hash":"78c4b8f775f094672a512055fe21e0df5d85514f","timestamp":1716091479422}